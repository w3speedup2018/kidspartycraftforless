/*
Generated time: February 5, 2023 09:13
This file was created by the app developer. Feel free to contact the original developer with any questions. It was minified (compressed) by AVADA. AVADA do NOT own this script.
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Instafeed=t()}(this,function(){"use strict";function n(e,t){if(!e)throw new Error(t)}function e(e){n(!e||"object"==typeof e,"options must be an object, got "+e+" ("+typeof e+")");var t={accessToken:null,accessTokenTimeout:1e4,after:null,apiTimeout:1e4,apiLimit:null,before:null,debug:!1,error:null,filter:null,limit:null,mock:!1,render:null,sort:null,success:null,target:"instafeed",template:'<a href="{{link}}"><img title="{{caption}}" src="{{image}}" /></a>',templateBoundaries:["{{","}}"],transform:null};if(e)for(var o in t)void 0!==e[o]&&(t[o]=e[o]);n("string"==typeof t.target||"object"==typeof t.target,"target must be a string or DOM node, got "+t.target+" ("+typeof t.target+")"),n("string"==typeof t.accessToken||"function"==typeof t.accessToken,"accessToken must be a string or function, got "+t.accessToken+" ("+typeof t.accessToken+")"),n("number"==typeof t.accessTokenTimeout,"accessTokenTimeout must be a number, got "+t.accessTokenTimeout+" ("+typeof t.accessTokenTimeout+")"),n("number"==typeof t.apiTimeout,"apiTimeout must be a number, got "+t.apiTimeout+" ("+typeof t.apiTimeout+")"),n("boolean"==typeof t.debug,"debug must be true or false, got "+t.debug+" ("+typeof t.debug+")"),n("boolean"==typeof t.mock,"mock must be true or false, got "+t.mock+" ("+typeof t.mock+")"),n("object"==typeof t.templateBoundaries&&2===t.templateBoundaries.length&&"string"==typeof t.templateBoundaries[0]&&"string"==typeof t.templateBoundaries[1],"templateBoundaries must be an array of 2 strings, got "+t.templateBoundaries+" ("+typeof t.templateBoundaries+")"),n(!t.template||"string"==typeof t.template,"template must null or string, got "+t.template+" ("+typeof t.template+")"),n(!t.error||"function"==typeof t.error,"error must be null or function, got "+t.error+" ("+typeof t.error+")"),n(!t.before||"function"==typeof t.before,"before must be null or function, got "+t.before+" ("+typeof t.before+")"),n(!t.after||"function"==typeof t.after,"after must be null or function, got "+t.after+" ("+typeof t.after+")"),n(!t.success||"function"==typeof t.success,"success must be null or function, got "+t.success+" ("+typeof t.success+")"),n(!t.filter||"function"==typeof t.filter,"filter must be null or function, got "+t.filter+" ("+typeof t.filter+")"),n(!t.transform||"function"==typeof t.transform,"transform must be null or function, got "+t.transform+" ("+typeof t.transform+")"),n(!t.sort||"function"==typeof t.sort,"sort must be null or function, got "+t.sort+" ("+typeof t.sort+")"),n(!t.render||"function"==typeof t.render,"render must be null or function, got "+t.render+" ("+typeof t.render+")"),n(!t.limit||"number"==typeof t.limit,"limit must be null or number, got "+t.limit+" ("+typeof t.limit+")"),n(!t.apiLimit||"number"==typeof t.apiLimit,"apiLimit must null or number, got "+t.apiLimit+" ("+typeof t.apiLimit+")"),this._state={running:!1,node:null,token:null,paging:null,pool:[]},this._options=t}return e.prototype.run=function(){var o=this;return this._debug("run","options",this._options),this._debug("run","state",this._state),this._state.running?(this._debug("run","already running, skipping"),!1):(this._start(),this._debug("run","getting dom node"),"string"==typeof this._options.target?this._state.node=document.getElementById(this._options.target):this._state.node=this._options.target,this._state.node?(this._debug("run","got dom node",this._state.node),this._debug("run","getting access token"),this._getAccessToken(function(e,t){e?(o._debug("onTokenReceived","error",e),o._fail(new Error("error getting access token: "+e.message))):(o._debug("onTokenReceived","got token",t),o._state.token=t,o._showNext(function(e){e?(o._debug("onNextShown","error",e),o._fail(e)):o._finish()}))}),!0):(this._fail(new Error("no element found with ID "+this._options.target)),!1))},e.prototype.hasNext=function(){var e=this._state.paging,t=this._state.pool;return this._debug("hasNext","paging",e),this._debug("hasNext","pool",t.length,t),0<t.length||e&&"string"==typeof e.next},e.prototype.next=function(){var t=this;return t.hasNext()?t._state.running?(t._debug("next","already running, skipping"),!1):(t._start(),void t._showNext(function(e){e?(t._debug("onNextShown","error",e),t._fail(e)):t._finish()})):(t._debug("next","hasNext is false, skipping"),!1)},e.prototype._showNext=function(s){var i=this,e=null,t="number"==typeof this._options.limit;if(i._debug("showNext","pool",i._state.pool.length,i._state.pool),0<i._state.pool.length){if(t=t?i._state.pool.splice(0,i._options.limit):i._state.pool.splice(0),i._debug("showNext","items from pool",t.length,t),i._debug("showNext","updated pool",i._state.pool.length,i._state.pool),i._options.mock)i._debug("showNext","mock enabled, skipping render");else try{i._renderData(t)}catch(e){return void s(e)}s(null)}else i._state.paging&&"string"==typeof i._state.paging.next?e=i._state.paging.next:(e="https://graph.instagram.com/me/media?fields=caption,id,media_type,media_url,permalink,thumbnail_url,timestamp,username&access_token="+i._state.token,i._options.apiLimit||"number"!=typeof i._options.limit?"number"==typeof i._options.apiLimit&&(i._debug("showNext","apiLimit set, overriding limit",i._options.apiLimit,i._options.limit),e=e+"&limit="+i._options.apiLimit):(i._debug("showNext","no apiLimit set, falling back to limit",i._options.apiLimit,i._options.limit),e=e+"&limit="+i._options.limit)),i._debug("showNext","making request",e),i._makeApiRequest(e,function(e,t){var o=null;if(e)i._debug("onResponseReceived","error",e),s(new Error("api request error: "+e.message));else{i._debug("onResponseReceived","data",t),i._success(t),i._debug("onResponseReceived","setting paging",t.paging),i._state.paging=t.paging;try{if(o=i._processData(t),i._debug("onResponseReceived","processed data",o),o.unused&&0<o.unused.length){i._debug("onResponseReceived","saving unused to pool",o.unused.length,o.unused);for(var n=0;n<o.unused.length;n++)i._state.pool.push(o.unused[n])}}catch(e){return void s(e)}if(i._options.mock)i._debug("onResponseReceived","mock enabled, skipping append");else try{i._renderData(o.items)}catch(e){return void s(e)}s(null)}})},e.prototype._processData=function(e){var t,o="function"==typeof this._options.transform,n="function"==typeof this._options.filter,s="function"==typeof this._options.sort,i="number"==typeof this._options.limit,r=[],a=null,u=null,p=null;if(this._debug("processData","hasFilter",n,"hasTransform",o,"hasSort",s,"hasLimit",i),"object"!=typeof e||"object"!=typeof e.data||e.data.length<=0)return null;for(var l=0;l<e.data.length;l++){if(t=this._getItemData(e.data[l]),o)try{a=this._options.transform(t),this._debug("processData","transformed item",t,a)}catch(e){throw this._debug("processData","error calling transform",e),new Error("error in transform: "+e.message)}else a=t;if(n){try{u=this._options.filter(a),this._debug("processData","filter item result",a,u)}catch(e){throw this._debug("processData","error calling filter",e),new Error("error in filter: "+e.message)}u&&r.push(a)}else r.push(a)}if(s)try{r.sort(this._options.sort)}catch(e){throw this._debug("processData","error calling sort",e),new Error("error in sort: "+e.message)}return i&&(s=r.length-this._options.limit,this._debug("processData","checking limit",r.length,this._options.limit,s),0<s)&&(p=r.slice(r.length-s),this._debug("processData","unusedItems",p.length,p),r.splice(r.length-s,s)),{items:r,unused:p}},e.prototype._extractTags=function(e){var t,o=/#([^\s]+)/gi,n=/[~`!@#$%^&*\(\)\-\+={}\[\]:;"'<>\?,\./|\\\s]+/i,s=[];if("string"==typeof e)for(;null!==(t=o.exec(e));)!1===n.test(t[1])&&s.push(t[1]);return s},e.prototype._getItemData=function(e){var t=null,o=null;switch(e.media_type){case"IMAGE":t="image",o=e.media_url;break;case"VIDEO":t="video",o=e.thumbnail_url;break;case"CAROUSEL_ALBUM":t="album",o=e.media_url}return{caption:e.caption,tags:this._extractTags(e.caption),id:e.id,image:o,link:e.permalink,model:e,timestamp:e.timestamp,type:t,username:e.username}},e.prototype._renderData=function(e){var t,o="string"==typeof this._options.template,n="function"==typeof this._options.render,s=null,i=null,r="";if(this._debug("renderData","hasTemplate",o,"hasRender",n),!("object"!=typeof e||e.length<=0)){for(var a=0;a<e.length;a++){if(t=e[a],n)try{s=this._options.render(t,this._options),this._debug("renderData","custom render result",t,s)}catch(e){throw this._debug("renderData","error calling render",e),new Error("error in render: "+e.message)}else o&&(s=this._basicRender(t));s?r+=s:this._debug("renderData","render item did not return any content",t)}for(this._debug("renderData","html content",r),(i=document.createElement("div")).innerHTML=r,this._debug("renderData","container",i,i.childNodes.length,i.childNodes);0<i.childNodes.length;)this._debug("renderData","appending child",i.childNodes[0]),this._state.node.appendChild(i.childNodes[0])}},e.prototype._basicRender=function(e){for(var t,o,n=new RegExp(this._options.templateBoundaries[0]+"([\\s\\w.]+)"+this._options.templateBoundaries[1],"gm"),s=this._options.template,i="",r=0,a=null;null!==(t=n.exec(s));)o=t[1],i+=s.slice(r,t.index),(a=this._valueForKeyPath(o,e))&&(i+=a.toString()),r=n.lastIndex;return r<s.length&&(i+=s.slice(r,s.length)),i},e.prototype._valueForKeyPath=function(e,t){for(var o,n=/([\w]+)/gm,s=t;null!==(o=n.exec(e));){if("object"!=typeof s)return null;s=s[o[1]]}return s},e.prototype._fail=function(e){!this._runHook("error",e)&&console&&"function"==typeof console.error&&console.error(e),this._state.running=!1},e.prototype._start=function(){this._state.running=!0,this._runHook("before")},e.prototype._finish=function(){this._runHook("after"),this._state.running=!1},e.prototype._success=function(e){this._runHook("success",e),this._state.running=!1},e.prototype._makeApiRequest=function(e,o){function n(e,t){s||(s=!0,o(e,t))}var s=!1,i=this,r=null;(r=new XMLHttpRequest).ontimeout=function(){n(new Error("api request timed out"))},r.onerror=function(){n(new Error("api connection error"))},r.onload=function(e){var t=r.getResponseHeader("Content-Type"),o=null;if(i._debug("apiRequestOnLoad","loaded",e),i._debug("apiRequestOnLoad","response status",r.status),i._debug("apiRequestOnLoad","response content type",t),0<=t.indexOf("application/json"))try{o=JSON.parse(r.responseText)}catch(e){return i._debug("apiRequestOnLoad","json parsing error",e,r.responseText),void n(new Error("error parsing response json"))}200===r.status?n(null,o):o&&o.error?n(new Error(o.error.code+" "+o.error.message)):n(new Error("status code "+r.status))},r.open("GET",e,!0),r.timeout=this._options.apiTimeout,r.send()},e.prototype._getAccessToken=function(o){function n(e,t){s||(s=!0,clearTimeout(r),o(e,t))}var s=!1,i=this,r=null;if("function"==typeof this._options.accessToken){this._debug("getAccessToken","calling accessToken as function"),r=setTimeout(function(){i._debug("getAccessToken","timeout check",s),n(new Error("accessToken timed out"),null)},this._options.accessTokenTimeout);try{this._options.accessToken(function(e,t){i._debug("getAccessToken","received accessToken callback",s,e,t),n(e,t)})}catch(e){this._debug("getAccessToken","error invoking the accessToken as function",e),n(e,null)}}else this._debug("getAccessToken","treating accessToken as static",typeof this._options.accessToken),n(null,this._options.accessToken)},e.prototype._debug=function(){var e=null;this._options.debug&&console&&"function"==typeof console.log&&((e=[].slice.call(arguments))[0]="[Instafeed] ["+e[0]+"]",console.log.apply(null,e))},e.prototype._runHook=function(t,e){var o=!1;if("function"==typeof this._options[t])try{this._options[t](e),o=!0}catch(e){this._debug("runHook","error calling hook",t,e)}return o},e});